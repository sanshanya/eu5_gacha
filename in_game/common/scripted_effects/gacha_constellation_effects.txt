gacha_apply_constellation_stats_effect = {
    # 1. 清理旧修正
    remove_character_modifier = gacha_$who$_c0_modifier
    remove_character_modifier = gacha_$who$_c1_modifier
    remove_character_modifier = gacha_$who$_c2_modifier
    remove_character_modifier = gacha_$who$_c3_modifier
    remove_character_modifier = gacha_$who$_c4_modifier
    remove_character_modifier = gacha_$who$_c5_modifier
    remove_character_modifier = gacha_$who$_c6_modifier
    remove_country_modifier   = gacha_$who$_c6_country_modifier

    # 2. 应用新修正 (使用  写法)
    if = {
        limit = { gacha_constellation_lvl = 0 }
        add_character_modifier = { modifier = gacha_$who$_c0_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl = 1 }
        add_character_modifier = { modifier = gacha_$who$_c1_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl = 2 }
        add_character_modifier = { modifier = gacha_$who$_c2_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl = 3 }
        add_character_modifier = { modifier = gacha_$who$_c3_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl = 4 }
        add_character_modifier = { modifier = gacha_$who$_c4_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl = 5 }
        add_character_modifier = { modifier = gacha_$who$_c5_modifier mode = add_and_extend years = -1 }
    }
    else_if = {
        limit = { gacha_constellation_lvl >= 6 }
        add_character_modifier = { modifier = gacha_$who$_c6_modifier mode = add_and_extend years = -1 }
    }
    if = {
        limit = { gacha_constellation_lvl >= 6 }
        root = {
            add_country_modifier = { modifier = gacha_$who$_c6_country_modifier days = -1 }
        }
    }

    # 3. 根据命座等级，添加额外的特性（完全泛型）
    # add_trait 不会重复添加，所以这样写是安全的
    if = {
        limit = { gacha_constellation_lvl >= 2 }
        add_trait = trait:gacha_$who$_awakened_trait
    }
    if = {
        limit = { gacha_constellation_lvl >= 4 }
        add_trait = trait:gacha_$who$_transcended_trait
    }
}
