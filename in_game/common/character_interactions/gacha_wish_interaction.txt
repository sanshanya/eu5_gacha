gacha_events_interaction = {
  message = no
  is_consort_action = no
  on_own_nation = yes
  ai_tick = never
  context_menu_click_mode = click

  # === 谁能看到 ===
  potential = {
    scope:actor = {
      has_ruler = yes
    }
  }

  # === 谁能点 ===
  # [FIX] 添加事件锁机制，防止快速点击触发多个事件实例
  allow = {
    scope:actor = {
      NOT = { has_variable = gacha_event_lock }
    }
  }
  select_trigger = {
    looking_for_a = character
    source = actor
    target_flag = recipient
    name = "gacha_select_title"
    column = { data = name }
    visible = {
      is_alive = yes
      is_ruler = yes
    }
  }
  # === 效果 ===
  effect = {
    scope:actor = {
      # [FIX] 立即设置事件锁，防止重复触发
      set_variable = { name = gacha_event_lock value = yes }
      
      # [V3] 打开菜单前先进行懒加载初始化，确保所有抽卡变量已就绪
      gacha_ensure_state_initialized = yes

      # 触发祈愿主菜单事件
      trigger_event_non_silently = gacha_events.1
    }
  }

  ai_will_do = { value = 0 }
}

