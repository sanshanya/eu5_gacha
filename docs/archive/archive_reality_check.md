# è®¾è®¡æ–‡æ¡£ v2.0 ç°å®æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ å®¡æŸ¥ç›®çš„

å¯¹æ¯”æœ‹å‹æä¾›çš„ `3_gacha_system_design_v2.md` ä¸å®é™…ä»£ç å’Œå¼•æ“èƒ½åŠ›ï¼Œè¯†åˆ«ï¼š
- âœ… **å·²å®ç°ä¸”æ­£ç¡®**çš„éƒ¨åˆ†
- âš ï¸ **å¹»è§‰/è¯¯å¯¼**çš„éƒ¨åˆ†  
- ğŸ”§ **éœ€è¦ä¿®æ­£**çš„æŠ€æœ¯ç»†èŠ‚

---

## ğŸ¯ æ€»ä½“è¯„ä»·

**æ–‡æ¡£è´¨é‡**: â­â­â­â˜†â˜† (3/5)
- **ä¼˜ç‚¹**: é€»è¾‘æ¸…æ™°ï¼Œæ¦‚ç‡æ¨¡å‹è®¾è®¡åˆç†
- **ä¸¥é‡é—®é¢˜**: 
  1. **åŒ…å«å¤§é‡ä¸å­˜åœ¨çš„ Pç¤¾è„šæœ¬è¯­æ³•**ï¼ˆå¦‚"æ•°å­¦æ³•å–æ¨¡"ï¼‰
  2. **è¯¯æŠ¥å·²ä¿®å¤çš„ bug**ï¼ˆå®é™…ä»£ç æ ¹æœ¬æ²¡ç”¨è¿‡ `random_list`ï¼‰
  3. **å»ºè®®çš„å®ç°æ–¹æ¡ˆéƒ¨åˆ†ä¸å¯è¡Œ**

---

## âŒ å¹»è§‰åˆ—è¡¨ (Critical Hallucinations)

### 1. **"æ•°å­¦æ³•å–æ¨¡ O(1)" - å®Œå…¨ä¸å­˜åœ¨** ğŸš¨

æ–‡æ¡£ç¬¬ 3.2 èŠ‚å£°ç§°å¯ä»¥ç”¨çº¯æ•°å­¦è¿ç®—å®ç°å–æ¨¡ï¼š

```paradox
# âŒ æ–‡æ¡£å£°ç§°çš„"æ•°å­¦æ³•" - è¿™æ˜¯å¹»è§‰ï¼
set_variable = { name = gacha_temp_calc value = var:gacha_rand }
change_variable = { name = gacha_temp_calc divide = 1000 }  # æ•´æ•°é™¤æ³•è‡ªåŠ¨å–æ•´
change_variable = { name = gacha_temp_calc multiply = 1000 }
change_variable = { name = gacha_rand subtract = var:gacha_temp_calc }
```

**ç°å®**:
- âœ… Pç¤¾è„šæœ¬**æœ‰** `divide` è¿ç®—ç¬¦
- âŒ Pç¤¾è„šæœ¬**æ²¡æœ‰æ•´æ•°é™¤æ³•è‡ªåŠ¨å–æ•´ç‰¹æ€§**
- âŒ `divide` ç›´æ¥åœ¨æµ®ç‚¹æ•°/å®šç‚¹æ•°ä¸Šæ“ä½œï¼Œæ— æ³•ç”¨äºå–æ¨¡

**è¯æ®**: æŸ¥çœ‹ `5_rng_fix_walkthrough.md` ç¬¬ 226 è¡Œ:
> **No modulo operator**: Must implement using `while` loops

**å®é™…ä»£ç ** (`gacha_logic_effects.txt` ç¬¬ 47-50 è¡Œ):
```paradox
# âœ… å®é™…ä½¿ç”¨çš„æ–¹æ³•ï¼šwhile å¾ªç¯
while = {
    limit = { var:gacha_rand_ones >= 10 }
    change_variable = { name = gacha_rand_ones subtract = 10 }
}
```

**ç»“è®º**: æ–‡æ¡£çš„"æ•°å­¦æ³•å–æ¨¡"æ˜¯ **AI å¹»è§‰**ï¼Œå®é™…å¿…é¡»ç”¨ while å¾ªç¯ã€‚

---

### 2. **"å·²ä¿®å¤æ€§èƒ½ç‚¸å¼¹" - è¯¯æŠ¥** ğŸ¤¥

æ–‡æ¡£ç¬¬ 3.3 èŠ‚å£°ç§°å­˜åœ¨ while å¾ªç¯æ€§èƒ½é—®é¢˜å¹¶å·²ä¿®å¤ï¼š

> å›½åº“=100,000,000 æ—¶ while å¾ªç¯ä¼šæ‰§è¡Œ ~100,000 æ¬¡ ğŸ’¥

**ç°å®**:
- âœ… å®é™…ä»£ç **ä»æœªå°è¯•å¯¹ treasury å–æ¨¡ 1000**
- âœ… åªå¯¹**ä¸ªä½æ•°**å–æ¨¡ 10ï¼ˆæœ€å¤š 10 æ¬¡å¾ªç¯ï¼‰
- âŒ **æ–‡æ¡£æè¿°çš„é—®é¢˜ä»æœªå­˜åœ¨è¿‡**

**å®é™…ä»£ç ** (`gacha_logic_effects.txt` ç¬¬ 44-50 è¡Œ):
```paradox
set_variable = { name = gacha_rand_ones value = var:gacha_rand }

# æå–ä¸ªä½æ•° (æœ€å¤š 10 æ¬¡å¾ªç¯)
while = {
    limit = { var:gacha_rand_ones >= 10 }
    change_variable = { name = gacha_rand_ones subtract = 10 }
}
```

**ç»“è®º**: æ–‡æ¡£çš„"æ€§èƒ½ç‚¸å¼¹"æ˜¯**å¹»è§‰åœºæ™¯**ï¼Œå½“å‰ä»£ç æ— æ­¤é—®é¢˜ã€‚

---

### 3. **"50/50 å¥‡å¶é™·é˜±å·²ä¿®å¤" - æ··æ·†å› æœ** ğŸ˜µ

æ–‡æ¡£ç¬¬ 5.1 èŠ‚å£°ç§° treasury å•ç‹¬ä½¿ç”¨ä¼šå¯¼è‡´å¥‡å¶é”å®šï¼š

> å¦‚æœæŠ½å¡æ¶ˆè€—æ˜¯å¶æ•°ï¼Œtreasury å¥‡å¶æ€§æ°¸ä¸æ”¹å˜

**ç°å®**:
- âš ï¸ å®é™…ä»£ç **åªç”¨ `total_rolls` åš 50/50**ï¼Œæ ¹æœ¬æ²¡ç”¨ treasury
- âš ï¸ æ–‡æ¡£æè¿°çš„æ˜¯ä¸€ä¸ª**ä»æœªå­˜åœ¨çš„æ¶æ„**

**å®é™…ä»£ç ** (`gacha_logic_effects.txt` ç¬¬ 108 è¡Œ):
```paradox
# âœ… å®é™…ï¼šåªç”¨ total_rollsï¼ˆæ¯æ¬¡+1ï¼Œå¿…ç„¶ç¿»è½¬ï¼‰
set_variable = { name = gacha_r50 value = var:gacha_total_rolls }
```

**ç»“è®º**: **æ²¡æœ‰é™·é˜±ï¼Œå› ä¸ºä»æœªæ‰è¿›å»è¿‡**ã€‚æ–‡æ¡£å¯èƒ½åœ¨æè¿°æŸä¸ªåºŸå¼ƒçš„è®¾è®¡ã€‚

---

### 4. **"éæ³•æƒé‡è¯­æ³• Bug" - å¼ å† ææˆ´** ğŸ­

æ–‡æ¡£é™„å½• B å¼•ç”¨ `5_reference_technical.md` ä¸­çš„ `random_list` bugï¼š

```paradox
# âŒ é”™è¯¯ï¼šéæ³•æƒé‡è¯­æ³•
random_list = {
    value:gacha_5star_threshold_value = { ... }
}
```

**ç°å®**:
- âœ… **å½“å‰ä»£ç æ ¹æœ¬æ²¡æœ‰ `random_list`**
- âœ… å·²æ”¹ç”¨ä¼ªéšæœºæ•°ç”Ÿæˆï¼ˆè§ `5_rng_fix_walkthrough.md`ï¼‰
- âŒ æ–‡æ¡£å¼•ç”¨çš„æ˜¯**å†å²é—ç•™é—®é¢˜**ï¼Œä¸æ˜¯å½“å‰æ¶æ„

**å®é™…ä»£ç ** (`gacha_logic_effects.txt` ç¬¬ 55-63 è¡Œ):
```paradox
# âœ… å½“å‰é€»è¾‘ï¼šçº¯ if åˆ¤æ–­ï¼Œæ—  random_list
if = {
    limit = { var:gacha_rand_ones < var:gacha_thresh5 }
    set_variable = { name = gacha_temp_roll_result value = 1 }
}
```

**ç»“è®º**: è¿™ä¸ª bug åœ¨ **v1.0 æ—¶ä»£å°±ä¿®äº†**ï¼Œæ–‡æ¡£æåŠå®¹æ˜“è¯¯å¯¼ã€‚

---

## âœ… æ­£ç¡®éƒ¨åˆ† (Accurate Sections)

### 1. **æ¦‚ç‡æ¨¡å‹** (ç¬¬ 2 èŠ‚)
âœ… è½¯ä¿åº•/ç¡¬ä¿åº•çš„æ•°å­¦å…¬å¼ä¸å®é™…ä»£ç ä¸€è‡´

**å¯¹æ¯”**:
- æ–‡æ¡£å…¬å¼ (ç¬¬ 2.1 èŠ‚)
- å®é™…ä»£ç  `gacha_values.txt` ç¬¬ 9-28 è¡Œ

âœ… **å®Œå…¨åŒ¹é…**

---

### 2. **ä¼ªéšæœºç§å­æ··åˆ** (ç¬¬ 3.1 èŠ‚)
âœ… æ–‡æ¡£æ­£ç¡®æè¿°äº†ç§å­æ¥æº

**å®é™…ä»£ç ** (`gacha_logic_effects.txt` ç¬¬ 17-19 è¡Œ):
```paradox
set_variable = { name = gacha_rand value = var:gacha_total_rolls }
change_variable = { name = gacha_rand add = var:gacha_pity_count }
change_variable = { name = gacha_rand add = treasury }
```

âœ… **å‡†ç¡®**

---

### 3. **å¤§ä¿åº•æœºåˆ¶** (ç¬¬ 5 èŠ‚)
âœ… é€»è¾‘æ­£ç¡®ï¼Œä»£ç å®ç°ä¸æ–‡æ¡£æè¿°ä¸€è‡´

---

## âš ï¸ éœ€è¦æ¾„æ¸…çš„è¯¯å¯¼ (Misleading Claims)

### 1. **"4 æ˜Ÿæ± æ‰©å±•"**
æ–‡æ¡£ç¬¬ 6.3 èŠ‚æåˆ° 4 æ˜Ÿæ± ï¼š

```paradox
# Choice = Seed mod 3
# 0 â†’ é‡‘å¸, 1 â†’ å¨æœ›, 2 â†’ æ­£ç»Ÿæ€§
```

**ç°å®**:
- âŒ **å½“å‰ä»£ç æ²¡æœ‰ 4 æ˜Ÿç³»ç»Ÿ**
- âŒ ä¹Ÿæ²¡æœ‰ `pity_4star_count` å˜é‡
- âŒ è¿™æ˜¯**æœªå®ç°çš„æœªæ¥åŠŸèƒ½**

---

### 2. **"å®Œæ•´æŠ½å¡æµç¨‹"** (ç¬¬ 8 èŠ‚)
æ–‡æ¡£æè¿°åŒ…å« 4 æ˜Ÿåˆ¤å®šï¼š

> b. IF pity_4star_count >= 10 OR rand < 51

**ç°å®**:
- âŒ **å®é™…ä»£ç æ— æ­¤é€»è¾‘**
- âœ… æœªå‡º 5 æ˜Ÿç›´æ¥è§¦å‘ `gacha_events.2`ï¼ˆ3 æ˜Ÿäº‹ä»¶ï¼‰

---

## ğŸ”§ æŠ€æœ¯ä¿®æ­£å»ºè®®

### ä¿®æ­£ 1: åˆ é™¤"æ•°å­¦æ³•å–æ¨¡"ç« èŠ‚
**åŸå› **: å¼•æ“ä¸æ”¯æŒï¼Œè¯¯å¯¼åç»­å¼€å‘è€…

**æ›¿ä»£**: æ˜ç¡®è¯´æ˜"Pç¤¾è„šæœ¬æ— åŸç”Ÿ moduloï¼Œå¿…é¡»ç”¨ while å¾ªç¯"

---

### ä¿®æ­£ 2: æ›´æ–°"å·²çŸ¥é—®é¢˜"åˆ—è¡¨
**åˆ é™¤**:
- âŒ "æ€§èƒ½ç‚¸å¼¹" (ä»æœªå­˜åœ¨)
- âŒ "éæ³•æƒé‡è¯­æ³•" (å·²åœ¨ v1.0 ä¿®å¤)
- âŒ "å¥‡å¶é™·é˜±" (ä»æœªä½¿ç”¨ treasury åš 50/50)

**æ·»åŠ **:
- âš ï¸ **å½“å‰çœŸå®é—®é¢˜**: åªæœ‰ 0-900 çš„éšæœºèŒƒå›´ï¼Œç¼ºå°‘ 900-999
- âš ï¸ **50/50 å¯é¢„æµ‹æ€§**: ç”¨ `total_rolls` åšå¥‡å¶ï¼Œç©å®¶ç†è®ºä¸Šå¯ä»¥é€šè¿‡è®¡æ•°æ¨æµ‹

---

### ä¿®æ­£ 3: æ ‡æ³¨"æœªå®ç°åŠŸèƒ½"
ä»¥ä¸‹ç« èŠ‚åº”åŠ  `[PLANNED]` æ ‡ç­¾ï¼š
- ç¬¬ 6.3 èŠ‚ (4 æ˜Ÿæ± )
- ç¬¬ 8 èŠ‚ä¸­çš„ 4 æ˜Ÿé€»è¾‘
- é™„å½• B ä¸­çš„"4 æ˜Ÿè§’è‰²æ± "

---

## ğŸ“Š å®é™… vs æ–‡æ¡£å·®å¼‚è¡¨

| æ–‡æ¡£å£°ç§° | å®é™…æƒ…å†µ | çŠ¶æ€ |
|---------|---------|------|
| æ•°å­¦æ³•å–æ¨¡ O(1) | while å¾ªç¯ O(n) | âŒ å¹»è§‰ |
| æ€§èƒ½ç‚¸å¼¹å·²ä¿®å¤ | ä»æœªå­˜åœ¨ | âŒ å¹»è§‰ |
| å¥‡å¶é™·é˜±å·²é¿å… | ä»æœªæ‰å…¥ | âš ï¸ æ··æ·† |
| random_list bug | å·²å¼ƒç”¨è¯¥æ–¹æ¡ˆ | âš ï¸ è¿‡æ—¶ |
| 4 æ˜Ÿç³»ç»Ÿ | æœªå®ç° | âš ï¸ æœªæ¥è§„åˆ’ |
| è½¯/ç¡¬ä¿åº•æ¦‚ç‡ | å®Œå…¨ä¸€è‡´ | âœ… æ­£ç¡® |
| å¤§ä¿åº•æœºåˆ¶ | å®Œå…¨ä¸€è‡´ | âœ… æ­£ç¡® |
| PRNG ç§å­æ··åˆ | å®Œå…¨ä¸€è‡´ | âœ… æ­£ç¡® |

---

## ğŸš€ åç»­å¼€å‘å»ºè®®

### å½“å‰ä»£ç çš„çœŸå®é™åˆ¶

1. **éšæœºèŒƒå›´ä¸è¶³**  
   - å½“å‰: 0-900 (ä¸ªä½æ•° Ã— 100)  
   - ç†æƒ³: 0-999  
   - **å¯è¡Œæ–¹æ¡ˆ**: æ”¹ä¸ºå–æœ€åä¸¤ä½æ•° (mod 100)ï¼Œå†ä¹˜ 10

2. **50/50 å¯é¢„æµ‹æ€§**  
   - å½“å‰: çº¯ç”¨ `total_rolls` å¥‡å¶  
   - é—®é¢˜: ç©å®¶å¯ä»¥è®¡æ•°  
   - **å¯è¡Œæ–¹æ¡ˆ**: æ··åˆ treasury: `(total_rolls + treasury) % 2`

3. **ç¼ºå°‘ 4 æ˜Ÿç³»ç»Ÿ**  
   - æ–‡æ¡£æè¿°ä½†æœªå®ç°  
   - **å¯è¡Œæ–¹æ¡ˆ**: åœ¨ `else` åˆ†æ”¯æ·»åŠ  4 æ˜Ÿåˆ¤å®š

---

## ğŸ ç»“è®º

**æ–‡æ¡£çš„æ ¸å¿ƒä»·å€¼**:
- âœ… æ¦‚ç‡æ¨¡å‹è®¾è®¡æ­£ç¡®
- âœ… ä¿åº•æœºåˆ¶æè¿°å‡†ç¡®
- âœ… å¤§æ–¹å‘å¯ä½œä¸ºå‚è€ƒ

**å¿…é¡»ä¿®æ­£çš„å¹»è§‰**:
- âŒ åˆ é™¤"æ•°å­¦æ³•å–æ¨¡" (å¼•æ“ä¸æ”¯æŒ)
- âŒ åˆ é™¤"æ€§èƒ½ç‚¸å¼¹" (ä»æœªå­˜åœ¨)
- âŒ æ›´æ–°"å·²çŸ¥é—®é¢˜" (å¤§éƒ¨åˆ†å·²è¿‡æ—¶)

**Pç¤¾è„šæœ¬çš„çœŸå®èƒ½åŠ›** (ç»å®æˆ˜éªŒè¯):
- âœ… æ”¯æŒ `while` å¾ªç¯
- âœ… æ”¯æŒå˜é‡åŠ å‡ä¹˜é™¤
- âœ… æ”¯æŒ `if-else` æ¡ä»¶åˆ¤æ–­
- âŒ **ä¸æ”¯æŒ**æ•´æ•°é™¤æ³•å–æ•´
- âŒ **ä¸æ”¯æŒ**åŸç”Ÿ modulo è¿ç®—ç¬¦
- âŒ `random_list` æ˜¯æ—¥æœŸç»‘å®šçš„ï¼ˆä¸å¯ç”¨äºåŒæ—¥å¤šæŠ½ï¼‰

---

## ğŸ“ å‚è€ƒæ–‡æ¡£

- `5_rng_fix_walkthrough.md` - RNG ä¿®å¤å…¨è¿‡ç¨‹
- `5_reference_technical.md` - å·²çŸ¥ Bug åˆ—è¡¨
- `gacha_logic_effects.txt` - å½“å‰å®é™…ä»£ç 

---

**å®¡æŸ¥æ—¥æœŸ**: 2025-11-23  
**å®¡æŸ¥äºº**: Antigravity (åŸºäºå®é™…ä»£ç å’Œæ–‡æ¡£äº¤å‰éªŒè¯)
