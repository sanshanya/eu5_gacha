划分文件 / 前缀（不强制重命名已有文件，但以后照这个来）：

* **通用 gacha 层** （所有角色共用）
* `common/scripted_effects/gacha_common_effects.txt`
* `common/scripted_triggers/gacha_trigger.txt`
* `events/gacha_events_events.txt`（你已经有了）
* 将来：`events/gacha_story_events.txt`（通用故事壳）
* **心海角色层**
  * `common/traits/xinhai_traits.txt`
  * `common/static_modifiers/xinhai_modifiers.txt`
  * `events/gacha_xinhai_events.txt`
  * `gfx/portraits/...` 里的一整套 xinhai_ 开头文件
  * `common/scripted_effects/xinhai_effects.txt`（负责心海专用 logic，比如命之座）
* **统一前缀风格**
  * 通用内容：`gacha_`
  * 心海专属：`xinhai_`
  * 全局角色列表变量：`gacha_char_list`
  * 通用 portrait trigger：`gacha_portrait_trigger`



# EU5 Gacha Mod 设计蓝图

## 1. 核心理念

**主题**：抽卡 + 陪伴
**定位**：轻量级陪伴型扩展，不全面接管游戏机制。
**体验**：

1. **即时反馈**：消耗金币 -> 祈愿 -> 出货的快感。
2. **长线陪伴**：角色作为廷臣/将领提供 Buff，并通过周期性剧情事件与玩家互动。

## 2. 核心循环 (MVP)

1. **积累资源**：正常游玩 EU5，攒钱。
2. **祈愿 (Gacha)**：通过决议/按钮进入祈愿池。
3. **角色登场**：获得角色，触发登场剧情，获得强力 Trait/Modifier。
4. **日常互动**：触发“锦囊妙计”或“日常闲聊”事件。
5. **重复获取**：再次抽到相同角色 -> 转化为“命之座”或资源（待实装）。

## 3. 开发阶段 (Phasing)

* **Phase 1 (当前)**：**架构搭建与心海 MVP**。
  * 跑通“交互 -> 抽卡池 -> 创角 -> 纸片人显示”全流程。
  * 实装心海的基础 Trait 和 Modifier。
* **Phase 2**：**剧情与互动系统**。
  * 实装月度脉冲 (Pulse)，触发心海的建议事件。
  * 完善好感度/命之座的变量埋点。
* **Phase 3**：**多角色扩展**。
  * 引入第二个角色（如雷神/神里），验证 Gacha 池的多角色兼容性。
* **Phase 4**：**深度系统**。
  * 好感度系统 UI、结婚/誓约系统、更多随机事件。

## 4. 技术细节：本地化中显示动态变量

> ⚠️ **待验证：以下内容尚未在游戏中进行实际测试。**


在P社游戏中，若想在本地化文本（如事件描述 `desc`）中显示由脚本控制的动态变量值（例如角色的命座层数），需要使用特定的语法。

**核心语法**：
```
[Scope.GetVariable('variable_name').GetValue]
```

**语法解析**：

*   **`[ ]`**：方括号用于包裹一个需要被游戏引擎评估和执行的函数或命令。
*   **`Scope`**：指代变量所在的上下文对象。这是最关键的部分，它决定了你要从哪个对象上获取变量。常见的 `Scope` 包括：
    *   `This`：通常指当前事件、效果或决议的**主导**对象（例如，如果事件是以角色为作用域触发的，`This` 就是这个角色）。
    *   `Root`：通常指事件的**根**作用域（例如，触发事件的国家）。
    *   `GetPlayer`：指代当前玩家国家。
    *   `GetGlobalVariable('global_variable_name')`：用于获取全局变量的值。
*   **`.GetVariable('variable_name')`**：这是一个函数调用，用于从指定的 `Scope` 对象上获取名为 `'variable_name'` 的变量对象。注意变量名需要用单引号 `' '` 包裹。
*   **`.GetValue`**：这是最后一步，用于从上一步获取到的变量对象中提取出其存储的实际数值。

**示例**：在事件描述中显示角色的命座层数

假设变量 `gacha_constellation_lvl` 存储在角色对象上，并且当事件触发时，这个角色是事件的 `This` 作用域。你可以在本地化文件中这样写：

```yaml
gacha_xinhai_events.2.desc: "随着祈愿的光芒汇入体内，珊瑚宫心海感到了一股熟悉的力量回归。\n\n当前命座等级：§Y[This.GetVariable('gacha_constellation_lvl').GetValue]§!"
```

**重要提示**：

*   确保 `Scope`（例如 `This` 或 `Root`）在事件/效果触发时，确实指向了持有该变量的对象。如果作用域不正确，变量将无法显示或显示为0。
*   `§Y` 和 `§!` 是P社本地化中常用的颜色代码，用于改变文本颜色，让显示的数值更突出。
*   这种语法是Jomini引擎（EU5使用的引擎）的通用实践，已在其他P社游戏中广泛使用。

